var config={pageSize:16,pageIndex:1,viewport:{width:189,height:245}},bookManagerScripts={init:function(){bookManagerScripts.loadData();bookManagerScripts.registerEvent()},registerEvent:function(){$(".Language").select2();$("#txtBookCategory").select2();jQuery.validator.setDefaults({debug:!0,success:"valid"});$("#frmEbook").validate({rules:{Name:{required:!0,minlength:8},Image:"required",PageNumber:{required:!0,min:1,number:!0},Capacity:{required:!0,min:0,number:!0},Authors:"required",DateRelease:{required:!0,min:1980,max:2090,number:!0},EbookType:"required",EbookCategory:"required",shortDescription:"required",LongDescription:"required"},messages:{Name:{required:"Tên là bắt buộc",minlength:"Tên yêu cầu ít nhất 8 ký tự"},Image:"Yêu cầu có ảnh đại diện",PageNumber:{required:"Nhập số trang",min:"Số trang phải ít nhất là 1!",number:"Số trang không hợp lệ!"},Capacity:{required:"Nhập dung lượng",min:"Số trang phải ít nhất là 0!",number:"Dung lượng không hợp lệ!"},Authors:"Nhập tên tác giả",DateRelease:{required:"Yêu cầu nhập năm",min:"Năm lớn hơn 1980",max:"Năm nhỏ hơn 2090",number:"Yêu cầu phải là số"},EbookType:"Yêu cầu nhập thể loại",EbookCategory:"Danh mục",shortDescription:"Yêu cầu nhập mô tả",LongDescription:"Yêu cầu nhập mô tả"}});$("#SaveEdit").off("click").on("click",function(){$("#frmEditData").valid()&&bookManagerScripts.Put()});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/books/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.message===null?toastr.error(n.message):n.status?(t.removeClass("label-danger"),t.addClass("label-success"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'><\/i>")):(t.removeClass("label-success"),t.addClass("label-danger"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'><\/i>"))}})});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa ebook này?",function(t){t&&bookManagerScripts.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&bookManagerScripts.deleteMul()})});$("#txtSearch").keypress(function(n){n.keyCode===13&&bookManagerScripts.loadData(!0)});$("#btn-refresh").off("click").on("click",function(){$("#txtSearch").val("");bookManagerScripts.loadData(!0)});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"));$(".selectedItem").prop("checked")?$("#btn-Deletemulti").removeClass("hidden"):$("#btn-Deletemulti").addClass("hidden")});$(".selectedItem").on("click",function(){$(this).attr("checked",this.checked?"":"checked")});$(".btn-search").on("click",function(){bookManagerScripts.loadData()});$(".selectedItem").on("change",function(){var n=$(".selectedItem").attr("checked").length;n>1?$("#btn-Deletemulti").removeAttr("disabled"):$("#btn-Deletemulti").add("disabled")})},"delete":function(n){$.ajax({url:"/Books/Delete",data:{id:n},type:"post",dataType:"json",success:function(){toastr.success("Xóa thành công");bookManagerScripts.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.warning("Không có phần tử nào được chọn!"):$.ajax({url:"/books/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){n.status?(toastr.success(n.message),bookManagerScripts.loadData(!0)):(toastr.error(n.message),bookManagerScripts.loadData(!0))}})},loadData:function(n){var t=$("#txtQuery").val(),i=$("#userId").val();$.ajax({url:"/Books/ManagersAsync",type:"GET",data:{query:t,userId:i,page:config.pageIndex,pageSize:config.pageSize},dataType:"json",success:function(t){var r,i,u,f;t.status&&(r=t.data,$("#txtQuery").val(""),i="",u=$("#data-template").html(),$.each(r,function(n,t){i+=Mustache.render(u,{ID:t.id,Name:t.name,Image:t.thumbnailUrl,CreatedDate:new Date(t.createdDate),CountDown:t.countDownload,Status:t.status===!1?"<span class='badge  badge-pill badge-warning'>chờ duyệt...<\/span>":"<span class='badge badge-pill badge-primary'>đã duyệt<\/span>"})}),$("#tbData").html(i),f=Math.ceil(t.total/config.pageSize),bookManagerScripts.paging(t.total,t.page,function(){bookManagerScripts.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(f)},n),bookManagerScripts.registerEvent())}})},paging:function(n,t,i){$("#pagination").pagination({items:n,itemsOnPage:config.pageSize,currentPage:t,hrefTextPrefix:"#trang-",prevText:"&lt",nextText:"&gt;",cssStyle:"light-theme",onPageClick:function(n){config.pageIndex=n;currentPage=n;setTimeout(i,0)}})}};bookManagerScripts.init();