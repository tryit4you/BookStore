"use strict";var config={pageSize:20,pageIndex:1},courseController={init:function(){courseController.loadData();courseController.loadCategory();courseController.registerEvent()},registerEvent:function(){$("#EditCourseCategory").select2();$("#txtCourseCategory").select2();$("#frmAddNew").validate({rules:{Name:"required",Image:"required",CourseCategory:"required",Description:"required",SharingUrl:"required"},messages:{Name:"Yêu cầu nhập tên Khóa Học",Image:"Yêu cầu phải có ảnh đại diện",CourseCategory:"Yêu cầu chọn một danh mục",Description:"Yêu cầu có mô tả",SharingUrl:"Yêu cầu linh chia sẻ"}});$("#frmEditData").validate({rules:{EditName:"required",EditImage:"required",EditCourseCategory:"required",EditDescription:"required",EditShareUrl:"required"},messages:{EditName:"Yêu cầu nhập tên",EditImage:"Yêu cầu ảnh",EditCourseCategory:"Yêu cầu chọn danh mục",EditDescription:"Yêu cầu mô tả",EditShareUrl:"Yêu cầu đường dẫn chia sẻ"}});$("#SaveEdit").off("click").on("click",function(){var n=$("#EditId").val();$("#frmEditData").valid()&&courseController.Put(n)});$("#btnAdd").off("click").on("click",function(){if($("#frmAddNew").valid()){var n=$("#txtName").val();courseController.checkExist(n)}});$(".btn-clear").off("click").on("click",function(){$("#txtSearch").val("");bookController.loadData()});$("#txtSearch").keypress(function(n){n.keyCode===13&&bookController.loadData(!0)});$(".btn-view").off("click").on("click",function(){var n=$(this).data("id");courseController.getDetail(n)});$(".btn-edit").off("click").on("click",function(){var n=$(this).data("id");$("ul.nav.nav-tabs a:eq(2)").tab("show");courseController.loadDetail(n)});$(".btn-delete").off("click").on("click",function(){var n=$(this).data("id");bootbox.confirm("Bạn có chắc chắn muốn xóa danh mục này không?",function(t){t&&courseController.delete(n)})});$("#btn-Deletemulti").off("click").on("click",function(){bootbox.confirm("Bạn có chắc muốn xóa các bản ghi được chọn không?",function(n){n&&courseController.deleteMul()})});$("#txtSearch").change(function(){courseController.loadData(!0)});$("#btn-Search").off("click").on("click",function(){courseController.loadData(!0)});$("#btn-refresh").off("click").on("click",function(){$("#txtSearch").val("");courseController.loadData(!0)});$(".btn-active").off("click").on("click",function(n){n.preventDefault();var i=$(this).data("id"),t=$(this);$.ajax({url:"/admin/course/ChangeStatus",data:{id:i},type:"post",dataType:"json",success:function(n){n.status?(t.removeClass("bg-red"),t.addClass("bg-green"),toastr.remove(),toastr.info("Đã kích hoạt"),t.html("<i class='fa fa-check'>Active<\/i>")):(t.removeClass("bg-green"),t.addClass("bg-red"),toastr.remove(),toastr.info("Đã hủy kích hoạt"),t.html("<i class='fa fa-ban'>NotActive<\/i>"))}})});$("#selectAll").change(function(){$(".selectedItem").prop("checked",$(this).prop("checked"))})},loadCategory:function(){var n=$("#txtCourseCategory"),t=$("#EditCourseCategory");$.ajax({url:"/admin/courseCategory/GetAll",type:"get",dataType:"json",success:function(i){if(i.status){n.empty();var r=i.data;$(r).each(function(i,r){n.append($("<option/>",{value:r.id,text:r.name}));t.append($("<option/>",{value:r.id,text:r.name}))})}}})},"delete":function(n){$.ajax({url:"/admin/course/Delete",data:{id:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);courseController.loadData(!0)}})},deleteMul:function(){var n=[];$("td input:checked").each(function(){n.push($(this).data("id"))});n.length===0?toastr.info("Không có phần tử nào được chọn!"):$.ajax({url:"/admin/course/DeleteMul",data:{ids:n},type:"post",dataType:"json",success:function(n){toastr.success(n.message);courseController.loadData(!0)}})},checkExist:function(n){$.ajax({url:"/admin/course/CheckExist",data:{name:n},type:"post",dataType:"json",success:function(t){t.result===!0?courseController.Post():$(".validate").html("Tên "+n+" đã tồn tại!")}})},Post:function(){var n=$("#txtName").val(),t=$("#ImgThumbnail").attr("src"),i=$("#txtCourseCategory").val(),r=tinymce.get("txtContent").getContent(),u=$("#txtAuthors").val(),f=$("#txtReference").val(),e=$("#txtSharingUrl").val(),o=$("#txtStatus").prop("checked"),s={Name:n,MetaName:commonController.getSeoTitle(n),AvatarData:t,CourseId:i,Authors:u,Reference:f,SharedUrl:e,Description:r,Status:o};$.ajax({url:"/admin/course/Post",data:{course:JSON.stringify(s)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),courseController.loadData(!0)):toastr.error(n.message)}})},Put:function(){var t=$("#EditId").val(),n=$("#EditName").val(),i=$("#EditThumbnail").attr("src"),r=$("#EditCourseCategory").val(),u=tinymce.get("EditContent").getContent(),f=$("#EditAuthors").val(),e=$("#EditReferenceText").val(),o=$("#sharedUrl").val(),s=$("#EditStatus").prop("checked"),h={Id:t,Name:n,MetaName:commonController.getSeoTitle(n),AvatarData:i,CourseId:r,Authors:f,Reference:e,SharedUrl:o,Description:u,Status:s};$.ajax({url:"/admin/course/Put",data:{course:JSON.stringify(h)},type:"post",dataType:"json",success:function(n){n.status?(location.reload(),toastr.success(n.message),courseController.loadData(!0)):toastr.error(n.message)}})},loadDetail:function(n){$.ajax({url:"/admin/course/GetDetail",data:{id:n},type:"post",dataType:"json",success:function(n){if(n.status){var t=n.data;$("#EditId").val(t.id);$("#EditThumbnail").attr("src",t.avatarData);$("#EditName").val(t.name);$("#EditAuthors").val(t.authors);$("#EditReferenceText").val(t.reference);$("#sharedUrl").val(t.sharedUrl);tinymce.get("EditContent").setContent(t.description);$("#EditStatus").prop("checked",t.status)}}})},getDetail:function(n){$.ajax({url:"/admin/course/GetDetail",data:{id:n},type:"post",dataType:"json",success:function(n){if(n.status){var t=n.data;$(".btnBrowser").attr("data-id",t.id);$("#modal-title").html(t.name);$("#content").html(t.content);$("#courseViewModel").modal("show")}}})},loadData:function(n){$.ajax({url:"/admin/course/GetAll",type:"post",dataType:"json",success:function(t){var r;if(t.status){var u=t.data,i="",f=$("#data-template").html();$.each(u,function(n,t){i+=Mustache.render(f,{ID:t.id,Name:t.name,Image:t.avatarData,CreatedDate:$.datepicker.formatDate("dd-mm-yy",new Date(t.createdDate)),Authors:t.authors,Status:t.status?"<a href='#' style='margin-top: 0%' class='btn-active badge bg-green' data-id='"+t.id+"'><i class='fa fa-check'><\/i>Active<\/a>":"<a href='#' style='margin-top: 0%' class='btn-active badge bg-red' data-id='"+t.id+"'>< i class='fa fa-ban'><\/i>NotActive<\/a>"})});$("#tbData").html(i);r=Math.ceil(t.total/config.pageSize);courseController.paging(t.total,function(){courseController.loadData();$("#currentpage").html(config.pageIndex);$("#totalpage").html(r)},n);courseController.registerEvent()}}})},paging:function(n,t,i){var r=Math.ceil(n/config.pageSize);($("#pagination a").length===0||i===!0)&&($("#pagination").empty(),$("#pagination").removeData("twbs-pagination"),$("#pagination").unbind("page"));$("#pagination").twbsPagination({totalPages:r,first:"Đầu",prev:"Trước",next:"Tiếp ",last:"Cuối",visiblePages:10,onPageClick:function(n,i){config.pageIndex=i;setTimeout(t,200)}})}};courseController.init();